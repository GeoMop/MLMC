

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Samples scheduling &mdash; mlmc 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MLMC package" href="mlmc.html" />
    <link rel="prev" title="Sampler creation" href="sampler_creation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="contents.html" class="icon icon-home"> mlmc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">MLMC Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#quickstart">Quickstart</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#create-mlmc-sampler">Create MLMC Sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#schedule-mlmc-samples">Schedule MLMC samples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sampler_creation.html">Sampler creation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Samples scheduling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prescribe-the-exact-number-of-samples-to-perform">1. Prescribe the exact number of samples to perform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prescribe-a-target-variance">2. Prescribe a target variance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mlmc.html">MLMC package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mlmc.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlmc.html#classes">Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mlmc.html#sampler">Sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlmc.html#samplingpool">SamplingPool</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlmc.html#samplingpoolpbs">SamplingPoolPBS</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlmc.html#samplestorage">SampleStorage</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlmc.html#samplestoragehdf">SampleStorageHDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlmc.html#estimate">Estimate</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlmc.html#moments">Moments</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlmc.html#levelsimulation">LevelSimulation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html">mlmc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="contents.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="examples.html">Tutorials</a> &raquo;</li>
        
      <li>Samples scheduling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/samples_scheduling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="mlmc.html" class="btn btn-neutral float-right" title="MLMC package" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="sampler_creation.html" class="btn btn-neutral float-left" title="Sampler creation" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="samples-scheduling">
<h1>Samples scheduling<a class="headerlink" href="#samples-scheduling" title="Permalink to this headline">¶</a></h1>
<p>Once you create a sampler you can schedule samples.</p>
<div class="section" id="prescribe-the-exact-number-of-samples-to-perform">
<h2>1. Prescribe the exact number of samples to perform<a class="headerlink" href="#prescribe-the-exact-number-of-samples-to-perform" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_samples</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">set_initial_n_samples</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
</pre></div>
</div>
<p>Schedule set samples</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span><span class="o">.</span><span class="n">schedule_samples</span><span class="p">()</span>
</pre></div>
</div>
<p>Wait until all samples are finished</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">running</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">running</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">running</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">running</span> <span class="o">+=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">ask_sampling_pool_for_samples</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="prescribe-a-target-variance">
<h2>2. Prescribe a target variance<a class="headerlink" href="#prescribe-a-target-variance" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_var</span> <span class="o">=</span> <span class="mf">1e-4</span>
</pre></div>
</div>
<p>The first phase is the same as the first approach, but the initial samples are automatically determined.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span><span class="o">.</span><span class="n">set_initial_n_samples</span><span class="p">()</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">schedule_samples</span><span class="p">()</span>
<span class="n">running</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">running</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">running</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">running</span> <span class="o">+=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">ask_sampling_pool_for_samples</span><span class="p">()</span>
</pre></div>
</div>
<p>The mlmc.quantity.quantity.Quantity instance is created
parameters ‘storage’ and ‘q_specs’ are obtained from sample_storage,
originally ‘q_specs’ is set in the simulation class</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">root_quantity</span> <span class="o">=</span> <span class="n">make_root_quantity</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">sampler</span><span class="o">.</span><span class="n">sample_storage</span><span class="p">,</span>
                               <span class="n">q_specs</span><span class="o">=</span><span class="n">sampler</span><span class="o">.</span><span class="n">sample_storage</span><span class="o">.</span><span class="n">load_result_format</span><span class="p">())</span>
</pre></div>
</div>
<p>Moment functions object is created
The MLMC algorithm determines number of samples according to the moments variance,
Type of moment functions (Legendre by default) might affect the total number of MLMC samples</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">moments_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_moments</span><span class="p">(</span><span class="n">root_quantity</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample_storage</span><span class="p">,</span> <span class="n">n_moments</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_moments</span><span class="p">)</span>
<span class="n">estimate_obj</span> <span class="o">=</span> <span class="n">Estimate</span><span class="p">(</span><span class="n">root_quantity</span><span class="p">,</span> <span class="n">sample_storage</span><span class="o">=</span><span class="n">sampler</span><span class="o">.</span><span class="n">sample_storage</span><span class="p">,</span>
                                       <span class="n">moments_fn</span><span class="o">=</span><span class="n">moments_fn</span><span class="p">)</span>
</pre></div>
</div>
<p>Initial estimation of the number of samples at each level</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">variances</span><span class="p">,</span> <span class="n">n_ops</span> <span class="o">=</span> <span class="n">estimate_obj</span><span class="o">.</span><span class="n">estimate_diff_vars_regression</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">n_finished_samples</span><span class="p">)</span>
</pre></div>
</div>
<p>Firstly, the variance of moments and execution time of samples at each level are calculated from already finished samples</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_estimated</span> <span class="o">=</span> <span class="n">estimate_n_samples_for_target_variance</span><span class="p">(</span><span class="n">target_var</span><span class="p">,</span> <span class="n">variances</span><span class="p">,</span> <span class="n">n_ops</span><span class="p">,</span>
                                                                       <span class="n">n_levels</span><span class="o">=</span><span class="n">sampler</span><span class="o">.</span><span class="n">n_levels</span><span class="p">)</span>
</pre></div>
</div>
<p>MLMC sampling algorithm - gradually schedules samples and refines the total number of samples</p>
<p>Loop until number of estimated samples is greater than the number of scheduled samples</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Jan Březina, Martin Špetlík.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>